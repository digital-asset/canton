..
   Copyright (c) 2026 Digital Asset (Switzerland) GmbH and/or its affiliates. All rights reserved.
..
   SPDX-License-Identifier: Apache-2.0

.. _setup-manual-identity:

Initializing node identity manually
===================================

Manual vs automatic identity initialization
-------------------------------------------

A Participant Node is initialized automatically by default, though it can also be initialized manually.
Manual initialization is useful in the following circumstances:

1. When a Participant Node does not control its own identity.
2. To avoid storing the identity key on the Participant Node for security reasons.
3. To explicitly set the Participant Node keys rather than relying on keys auto-generated by the Participant Node.

To disable the automatic initialization of a Participant Node, add the following to the configuration:

.. literalinclude:: CANTON/community/app/src/test/resources/participant1-manual-init.conf
   :start-after: user-manual-entry-begin: ManualParticipantNodeIdentityConfig
   :end-before: user-manual-entry-end: ManualParticipantNodeIdentityConfig
   :dedent:

Start the Participant Node with the above configuration settings.

Key initialization
------------------

Besides a namespace key and signing keys, a Participant Node also has an asymmetric encryption key
used to encrypt and decrypt transactions. By default, Participant Nodes create keys automatically, but if you choose to
manually set up a Participant Node, use the following commands to generate the namespace, signing, and encryption keys:

.. literalinclude:: CANTON/community/app/src/test/scala/com/digitalasset/canton/integration/tests/topology/TopologyManagementHelper.scala
   :language: scala
   :start-after: architecture-handbook-entry-begin: ManualInitKeys
   :end-before: architecture-handbook-entry-end: ManualInitKeys
   :dedent:

If you use a Key Management Service (KMS) to manage Canton's keys, and you want to use a set of pre-generated keys,
use the commands `register_kms_signing_key()` and `register_kms_encryption_key()` instead.
Please refer to :ref:`External Key Storage with a Key Management Service (KMS) <external_key_storage>` for more details.

Participant Node manual initialization
--------------------------------------

After the keys have been generated, or in the case of KMS, the KMS-generated keys have been registered, manually
initialize a Participant Node as follows:

.. literalinclude:: CANTON/community/app/src/test/scala/com/digitalasset/canton/integration/tests/topology/TopologyManagementHelper.scala
   :language: scala
   :start-after: architecture-handbook-entry-begin: ManualInitNode
   :end-before: architecture-handbook-entry-end: ManualInitNode
   :dedent:

Wait for the Participant Node to initialize:

.. literalinclude:: CANTON/community/app/src/test/scala/com/digitalasset/canton/integration/tests/upgrade/MajorUpgradeUtils.scala
   :language: scala
   :start-after: user-manual-entry-begin: WaitForParticipantInitialization
   :end-before: user-manual-entry-end: WaitForParticipantInitialization
   :dedent:

Finally, you can begin using the new Participant Node.
